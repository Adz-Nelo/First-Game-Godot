[gd_scene load_steps=16 format=3 uid="uid://d7smj0hg4h1e"]

[ext_resource type="Texture2D" uid="uid://b7ga0pxea3o0c" path="res://Sunny Land Collection Files/Assets/Characters/Enemies and NPC/Opossum/opossum/opossum-1.png" id="1_3xbym"]
[ext_resource type="Texture2D" uid="uid://dsa6siqhy4sxe" path="res://Sunny Land Collection Files/Assets/Props Items and VFX/Sunnyland FX/Sprites/enemy-death/enemy-death-1.png" id="1_ssx64"]
[ext_resource type="Texture2D" uid="uid://dla8rlmfwm0nf" path="res://Sunny Land Collection Files/Assets/Characters/Enemies and NPC/Opossum/opossum/opossum-2.png" id="2_i5bjm"]
[ext_resource type="Texture2D" uid="uid://bpqgvyv7ku6m6" path="res://Sunny Land Collection Files/Assets/Props Items and VFX/Sunnyland FX/Sprites/enemy-death/enemy-death-2.png" id="2_jgv2w"]
[ext_resource type="Texture2D" uid="uid://dqi0fnsksuj1g" path="res://Sunny Land Collection Files/Assets/Props Items and VFX/Sunnyland FX/Sprites/enemy-death/enemy-death-3.png" id="3_eocaq"]
[ext_resource type="Texture2D" uid="uid://7g1ibnfqfpcm" path="res://Sunny Land Collection Files/Assets/Characters/Enemies and NPC/Opossum/opossum/opossum-3.png" id="3_q1jwu"]
[ext_resource type="Texture2D" uid="uid://c7byl5vvjj20m" path="res://Sunny Land Collection Files/Assets/Characters/Enemies and NPC/Opossum/opossum/opossum-4.png" id="4_ft7pu"]
[ext_resource type="Texture2D" uid="uid://odgseuoliqpg" path="res://Sunny Land Collection Files/Assets/Props Items and VFX/Sunnyland FX/Sprites/enemy-death/enemy-death-4.png" id="4_lhowr"]
[ext_resource type="Texture2D" uid="uid://b2rvetpyxkcfa" path="res://Sunny Land Collection Files/Assets/Props Items and VFX/Sunnyland FX/Sprites/enemy-death/enemy-death-5.png" id="5_25dy3"]
[ext_resource type="Texture2D" uid="uid://d3nxh7nao4286" path="res://Sunny Land Collection Files/Assets/Characters/Enemies and NPC/Opossum/opossum/opossum-5.png" id="5_b5qag"]
[ext_resource type="Texture2D" uid="uid://bt5bwwsnb7hat" path="res://Sunny Land Collection Files/Assets/Characters/Enemies and NPC/Opossum/opossum/opossum-6.png" id="6_xgvlc"]
[ext_resource type="Texture2D" uid="uid://ckqitcv5688vs" path="res://Sunny Land Collection Files/Assets/Props Items and VFX/Sunnyland FX/Sprites/enemy-death/enemy-death-6.png" id="6_xxq4j"]

[sub_resource type="GDScript" id="GDScript_wjnk1"]
script/source = "extends CharacterBody2D

@onready var animated_sprite = $AnimatedSprite2D
@onready var ray_cast_right = $RayCastRight
@onready var ray_cast_left = $RayCastLeft

# Movement settings
@export var walk_speed = 50.0
@export var random_walk = false  # Set to true for random movement

var direction = 1  # 1 = right, -1 = left
var walk_timer = 0.0
var idle_timer = 0.0
var is_idle = false

func _ready() -> void:
	# Start walking animation
	if animated_sprite:
		animated_sprite.play(\"Walk\")  # Change to your walk animation name
	
	# Randomize starting direction
	if randf() > 0.5:
		direction = -1
		if animated_sprite:
			animated_sprite.flip_h = true

func _physics_process(delta: float) -> void:
	# Add gravity
	if not is_on_floor():
		velocity += get_gravity() * delta
	
	if random_walk:
		random_walking(delta)
	else:
		patrol_walking()
	
	move_and_slide()

func patrol_walking():
	# Simple back and forth patrol
	velocity.x = direction * walk_speed
	
	# Check if there's a wall or edge ahead
	var hit_wall = false
	
	if direction == 1 and ray_cast_right and ray_cast_right.is_colliding():
		hit_wall = true
	elif direction == -1 and ray_cast_left and ray_cast_left.is_colliding():
		hit_wall = true
	
	# Also check for edges (no ground ahead)
	if direction == 1 and ray_cast_right and not ray_cast_right.is_colliding():
		# Check if there's a ground detection raycast
		var ground_check = get_node_or_null(\"RayCastGroundRight\")
		if ground_check and not ground_check.is_colliding():
			hit_wall = true
	elif direction == -1 and ray_cast_left and not ray_cast_left.is_colliding():
		var ground_check = get_node_or_null(\"RayCastGroundLeft\")
		if ground_check and not ground_check.is_colliding():
			hit_wall = true
	
	# Turn around if hit wall or edge
	if hit_wall:
		turn_around()

func random_walking(delta: float):
	# Random walking with occasional stops
	if is_idle:
		velocity.x = 0
		idle_timer -= delta
		
		if idle_timer <= 0:
			is_idle = false
			walk_timer = randf_range(2.0, 5.0)
			
			# Random chance to change direction
			if randf() > 0.5:
				turn_around()
			
			if animated_sprite:
				animated_sprite.play(\"Walk\")
	else:
		velocity.x = direction * walk_speed
		walk_timer -= delta
		
		if walk_timer <= 0:
			is_idle = true
			idle_timer = randf_range(1.0, 3.0)
			
			if animated_sprite:
				animated_sprite.play(\"Idle\")
	
	# Still check for walls/edges
	if ray_cast_right and direction == 1 and ray_cast_right.is_colliding():
		turn_around()
	elif ray_cast_left and direction == -1 and ray_cast_left.is_colliding():
		turn_around()

func turn_around():
	direction *= -1
	if animated_sprite:
		animated_sprite.flip_h = !animated_sprite.flip_h
"

[sub_resource type="RectangleShape2D" id="RectangleShape2D_ssx64"]
size = Vector2(28, 14)

[sub_resource type="SpriteFrames" id="SpriteFrames_dy5wv"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": ExtResource("1_ssx64")
}, {
"duration": 1.0,
"texture": ExtResource("2_jgv2w")
}, {
"duration": 1.0,
"texture": ExtResource("3_eocaq")
}, {
"duration": 1.0,
"texture": ExtResource("4_lhowr")
}, {
"duration": 1.0,
"texture": ExtResource("5_25dy3")
}, {
"duration": 1.0,
"texture": ExtResource("6_xxq4j")
}],
"loop": true,
"name": &"Death",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": ExtResource("1_3xbym")
}, {
"duration": 1.0,
"texture": ExtResource("2_i5bjm")
}, {
"duration": 1.0,
"texture": ExtResource("3_q1jwu")
}, {
"duration": 1.0,
"texture": ExtResource("4_ft7pu")
}, {
"duration": 1.0,
"texture": ExtResource("5_b5qag")
}, {
"duration": 1.0,
"texture": ExtResource("6_xgvlc")
}],
"loop": true,
"name": &"Walk",
"speed": 5.0
}]

[node name="Opossum" type="CharacterBody2D"]
script = SubResource("GDScript_wjnk1")

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
position = Vector2(-3, -6)
shape = SubResource("RectangleShape2D_ssx64")

[node name="AnimatedSprite2D" type="AnimatedSprite2D" parent="."]
position = Vector2(1.0000002, -12.000001)
scale = Vector2(1.2142857, 1.2142857)
sprite_frames = SubResource("SpriteFrames_dy5wv")
animation = &"Walk"
