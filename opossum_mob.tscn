[gd_scene load_steps=18 format=3 uid="uid://y350op7evxrm"]

[ext_resource type="Texture2D" uid="uid://b7ga0pxea3o0c" path="res://Sunny Land Collection Files/Assets/Characters/Enemies and NPC/Opossum/opossum/opossum-1.png" id="1_jin7k"]
[ext_resource type="Texture2D" uid="uid://dsa6siqhy4sxe" path="res://Sunny Land Collection Files/Assets/Props Items and VFX/Sunnyland FX/Sprites/enemy-death/enemy-death-1.png" id="1_su347"]
[ext_resource type="Texture2D" uid="uid://dla8rlmfwm0nf" path="res://Sunny Land Collection Files/Assets/Characters/Enemies and NPC/Opossum/opossum/opossum-2.png" id="2_546ar"]
[ext_resource type="Texture2D" uid="uid://bpqgvyv7ku6m6" path="res://Sunny Land Collection Files/Assets/Props Items and VFX/Sunnyland FX/Sprites/enemy-death/enemy-death-2.png" id="2_nsonp"]
[ext_resource type="Texture2D" uid="uid://7g1ibnfqfpcm" path="res://Sunny Land Collection Files/Assets/Characters/Enemies and NPC/Opossum/opossum/opossum-3.png" id="3_3oi0w"]
[ext_resource type="Texture2D" uid="uid://dqi0fnsksuj1g" path="res://Sunny Land Collection Files/Assets/Props Items and VFX/Sunnyland FX/Sprites/enemy-death/enemy-death-3.png" id="3_acqqk"]
[ext_resource type="Texture2D" uid="uid://odgseuoliqpg" path="res://Sunny Land Collection Files/Assets/Props Items and VFX/Sunnyland FX/Sprites/enemy-death/enemy-death-4.png" id="4_33vr1"]
[ext_resource type="Texture2D" uid="uid://c7byl5vvjj20m" path="res://Sunny Land Collection Files/Assets/Characters/Enemies and NPC/Opossum/opossum/opossum-4.png" id="4_qq0cp"]
[ext_resource type="Texture2D" uid="uid://b2rvetpyxkcfa" path="res://Sunny Land Collection Files/Assets/Props Items and VFX/Sunnyland FX/Sprites/enemy-death/enemy-death-5.png" id="5_5xljj"]
[ext_resource type="Texture2D" uid="uid://d3nxh7nao4286" path="res://Sunny Land Collection Files/Assets/Characters/Enemies and NPC/Opossum/opossum/opossum-5.png" id="5_yrhq4"]
[ext_resource type="Texture2D" uid="uid://bt5bwwsnb7hat" path="res://Sunny Land Collection Files/Assets/Characters/Enemies and NPC/Opossum/opossum/opossum-6.png" id="6_n0qr7"]
[ext_resource type="Texture2D" uid="uid://ckqitcv5688vs" path="res://Sunny Land Collection Files/Assets/Props Items and VFX/Sunnyland FX/Sprites/enemy-death/enemy-death-6.png" id="6_ybag5"]

[sub_resource type="GDScript" id="GDScript_nqyi3"]
script/source = "extends CharacterBody2D

const SPEED = 50.0
const GRAVITY = 980.0

@onready var animated_sprite = $AnimatedSprite2D

var direction = -1  # Start moving left
var is_dead = false

func _ready():
	animated_sprite.play(\"Walk\")

func _physics_process(delta: float) -> void:
	if is_dead:
		return
	
	# Apply gravity
	if not is_on_floor():
		velocity.y += GRAVITY * delta
	
	# Move in current direction
	velocity.x = direction * SPEED
	
	# Flip sprite based on direction (reversed to fix moonwalking)
	if direction == -1:
		animated_sprite.flip_h = false  # Facing left, no flip
	else:
		animated_sprite.flip_h = true   # Facing right, flip
	
	move_and_slide()
	
	# Check if hit a wall - turn around
	if is_on_wall():
		direction *= -1

# Player stomps opossum from top (kills opossum)
func _on_player_death_body_entered(body: Node2D) -> void:
	if body.name == \"Player\" and not is_dead:
		print(\"ðŸ’€ Opossum stomped!\")
		AudioController.play_stomp_enemy()
		body.bounce_after_stomp()
		death()

# Player collides with opossum from side/bottom (damages player)
func _on_player_collision_body_entered(body: Node2D) -> void:
	if body.name == \"Player\" and not is_dead:
		print(\"ðŸ’¥ Opossum hit player from side!\")
		body.take_damage(1)

func death():
	if is_dead:
		return
	
	is_dead = true
	Game.score += 100
	
	# Play death animation
	animated_sprite.play(\"Death\")
	
	# Disable collision
	$CollisionShape2D.set_deferred(\"disabled\", true)
	
	# Wait for death animation then remove
	await get_tree().create_timer(0.5).timeout
	queue_free()
"

[sub_resource type="RectangleShape2D" id="RectangleShape2D_su347"]
size = Vector2(26, 11)

[sub_resource type="SpriteFrames" id="SpriteFrames_nsonp"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": ExtResource("1_su347")
}, {
"duration": 1.0,
"texture": ExtResource("2_nsonp")
}, {
"duration": 1.0,
"texture": ExtResource("3_acqqk")
}, {
"duration": 1.0,
"texture": ExtResource("4_33vr1")
}, {
"duration": 1.0,
"texture": ExtResource("5_5xljj")
}, {
"duration": 1.0,
"texture": ExtResource("6_ybag5")
}],
"loop": true,
"name": &"Death",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": ExtResource("1_jin7k")
}, {
"duration": 1.0,
"texture": ExtResource("2_546ar")
}, {
"duration": 1.0,
"texture": ExtResource("3_3oi0w")
}, {
"duration": 1.0,
"texture": ExtResource("4_qq0cp")
}, {
"duration": 1.0,
"texture": ExtResource("5_yrhq4")
}, {
"duration": 1.0,
"texture": ExtResource("6_n0qr7")
}],
"loop": true,
"name": &"Walking",
"speed": 5.0
}]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_nsonp"]
size = Vector2(21, 8)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_acqqk"]
size = Vector2(26, 18)

[node name="opossumMob" type="CharacterBody2D"]
script = SubResource("GDScript_nqyi3")

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
position = Vector2(-3, 4.5)
shape = SubResource("RectangleShape2D_su347")

[node name="AnimatedSprite2D" type="AnimatedSprite2D" parent="."]
sprite_frames = SubResource("SpriteFrames_nsonp")
animation = &"Walking"
autoplay = "Walking"

[node name="PlayerDeath" type="Area2D" parent="."]

[node name="CollisionShape2D" type="CollisionShape2D" parent="PlayerDeath"]
position = Vector2(-3.5, 4)
shape = SubResource("RectangleShape2D_nsonp")

[node name="PlayerCollision" type="Area2D" parent="."]

[node name="CollisionShape2D" type="CollisionShape2D" parent="PlayerCollision"]
position = Vector2(-3, 4)
shape = SubResource("RectangleShape2D_acqqk")

[connection signal="body_entered" from="PlayerDeath" to="." method="_on_player_death_body_entered"]
[connection signal="body_entered" from="PlayerCollision" to="." method="_on_player_collision_body_entered"]
