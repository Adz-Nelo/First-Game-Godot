[gd_scene load_steps=2 format=3 uid="uid://y350op7evxrm"]

[sub_resource type="GDScript" id="GDScript_nqyi3"]
script/source = "extends CharacterBody2D

const SPEED = 50.0
const GRAVITY = 980.0

@onready var animated_sprite = $AnimatedSprite2D

var direction = -1  # Start moving left
var is_dead = false
var just_stomped = false  # Flag to prevent collision damage during stomp

func _ready():
	animated_sprite.play(\"Walk\")

func _physics_process(delta: float) -> void:
	if is_dead:
		return
	
	# Apply gravity
	if not is_on_floor():
		velocity.y += GRAVITY * delta
	
	# Move in current direction
	velocity.x = direction * SPEED
	
	# Flip sprite based on direction (reversed to fix moonwalking)
	if direction == -1:
		animated_sprite.flip_h = false  # Facing left, no flip
	else:
		animated_sprite.flip_h = true   # Facing right, flip
	
	move_and_slide()
	
	# Check if hit a wall - turn around
	if is_on_wall():
		direction *= -1

# Player stomps opossum from top (kills opossum)
func _on_player_death_body_entered(body: Node2D) -> void:
	if body.name == \"Player\" and not is_dead:
		just_stomped = true  # Set flag first!
		
		# DISABLE PlayerCollision immediately to prevent it from triggering
		$PlayerCollision.monitoring = false
		
		print(\"ðŸ’€ Opossum stomped!\")
		AudioController.play_stomp_enemy()
		body.bounce_after_stomp()
		death()

# Player collides with opossum from side/bottom (damages player)
func _on_player_collision_body_entered(body: Node2D) -> void:
	if body.name == \"Player\" and not is_dead and not just_stomped:
		print(\"ðŸ’¥ Opossum hit player from side!\")
		body.take_damage(1)

func death():
	if is_dead:
		return
	
	is_dead = true
	Game.score += 100
	
	# Play death animation
	animated_sprite.play(\"Death\")
	
	# Disable collision
	$CollisionShape2D.set_deferred(\"disabled\", true)
	
	# Wait for death animation then remove
	await get_tree().create_timer(0.5).timeout
	queue_free()
"

[node name="opossumMob" type="CharacterBody2D"]
script = SubResource("GDScript_nqyi3")
