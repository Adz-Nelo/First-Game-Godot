[gd_scene load_steps=13 format=3 uid="uid://chuebjphy8ych"]

[ext_resource type="Texture2D" uid="uid://bl2i3pgme2xsc" path="res://sunny-land/assets/environment/back.png" id="1_se8ut"]
[ext_resource type="Texture2D" uid="uid://b3vi0lt8tntfs" path="res://sunny-land/assets/environment/middle.png" id="2_ao2gm"]
[ext_resource type="Texture2D" uid="uid://dise766nqts3d" path="res://sunny-land/assets/sprites/options.png" id="3_ao2gm"]
[ext_resource type="FontFile" uid="uid://bfgbx46b3ptly" path="res://RETRO_SPACE/RETRO_SPACE_INV.ttf" id="4_07a1d"]
[ext_resource type="Theme" uid="uid://de7qgtf8sy4q3" path="res://back-btn.tres" id="5_kls10"]
[ext_resource type="Texture2D" uid="uid://bk28x5epyqut4" path="res://buttons/back-btn.png" id="6_0kfld"]
[ext_resource type="PackedScene" uid="uid://dcufthl211jbm" path="res://volume_slider.tscn" id="7_0kfld"]

[sub_resource type="GDScript" id="GDScript_07a1d"]
script/source = "extends Node

# Called when the node enters the scene tree for the first time.
func _ready() -> void:
	$Label.modulate = Color.BLACK

func _on_back_btn_pressed() -> void:
	AudioController.select_sound()
	get_tree().change_scene_to_file(\"res://main.tscn\")
"

[sub_resource type="StyleBoxTexture" id="StyleBoxTexture_w5qgn"]
texture = ExtResource("6_0kfld")
region_rect = Rect2(169.42001, 188.13046, 160.93002, 118.37955)

[sub_resource type="StyleBoxTexture" id="StyleBoxTexture_kls10"]
texture = ExtResource("6_0kfld")
region_rect = Rect2(163.42674, 184.74947, 173.45592, 128.92567)

[sub_resource type="StyleBoxTexture" id="StyleBoxTexture_0kfld"]
texture = ExtResource("6_0kfld")
region_rect = Rect2(172.64297, 189.2893, 155.85123, 118.67996)

[sub_resource type="GDScript" id="GDScript_0kfld"]
script/source = "extends Control

func _ready():
	apply_retro_sunny_theme()
	
func _input(event: InputEvent) -> void:
	if Input.is_action_just_pressed(\"ui_cancel\"):
		get_tree().change_scene_to_file(\"res://main.tscn\")
		AudioController.select_sound()

func apply_retro_sunny_theme():
	# Retro sunny color palette
	var retro_colors = {
		\"Master\": Color(\"#FF6B35\"),      # Hot orange-red
		\"Music\": Color(\"#F7B801\"),       # Golden yellow
		\"Sound-Effect\": Color(\"#07A0C3\") # Cyan blue
	}
	
	# Apply to all HSliders
	for child in get_children():
		if child is HSlider:
			var slider = child as HSlider
			var bus_color = retro_colors.get(slider.bus_name, Color.WHITE)
			
			# Create retro slider style
			create_retro_slider_style(slider, bus_color)
			
			# Add volume percentage display
			add_volume_percentage(slider, bus_color)
			
			# Apply retro label styling (the text above each slider)
			var label = get_node_or_null(slider.bus_name.replace(\"-\", \"_\") + \"_label\")
			if label is Label:
				style_retro_label(label, bus_color)

func create_retro_slider_style(slider: HSlider, color: Color):
	# 1. Background bar (track)
	var bg_style = StyleBoxFlat.new()
	bg_style.bg_color = Color(\"#1A1A2E\")  # Dark retro navy
	bg_style.corner_radius_top_left = 8
	bg_style.corner_radius_top_right = 8
	bg_style.corner_radius_bottom_left = 8
	bg_style.corner_radius_bottom_right = 8
	# Retro thick border
	bg_style.border_color = color.darkened(0.5)
	bg_style.border_width_left = 3
	bg_style.border_width_right = 3
	bg_style.border_width_top = 3
	bg_style.border_width_bottom = 3
	# Inner shadow
	bg_style.shadow_color = Color(0, 0, 0, 0.6)
	bg_style.shadow_size = 2
	
	# 2. Fill (progress bar) - Retro gradient effect
	var fill_style = StyleBoxFlat.new()
	fill_style.bg_color = color
	fill_style.corner_radius_top_left = 6
	fill_style.corner_radius_bottom_left = 6
	# Top highlight for 3D effect
	fill_style.border_width_top = 2
	fill_style.border_color = color.lightened(0.3)
	
	# 3. Grabber (handle) - RETRO CIRCULAR BUTTON STYLE
	var handle_style = StyleBoxFlat.new()
	handle_style.bg_color = Color(\"#FFE66D\")  # Bright sunny yellow
	
	# Make it circular - perfect circle
	handle_style.corner_radius_top_left = 999  # Large value for perfect circle
	handle_style.corner_radius_top_right = 999
	handle_style.corner_radius_bottom_left = 999
	handle_style.corner_radius_bottom_right = 999
	
	# Retro concentric circles effect
	handle_style.border_color = Color(\"#FF6B35\")  # Orange inner border
	handle_style.border_width_left = 2
	handle_style.border_width_right = 2
	handle_style.border_width_top = 2
	handle_style.border_width_bottom = 2
	
	# Outer black border for retro look
	handle_style.set_content_margin(SIDE_LEFT, 3)
	handle_style.set_content_margin(SIDE_RIGHT, 3)
	handle_style.set_content_margin(SIDE_TOP, 3)
	handle_style.set_content_margin(SIDE_BOTTOM, 3)
	
	# Radial gradient effect (simulated with shadow)
	handle_style.shadow_color = color.lightened(0.2)
	handle_style.shadow_size = 8
	handle_style.shadow_offset = Vector2(0, 0)
	
	# 4. Handle when highlighted (being dragged) - CIRCULAR WITH GLOW
	var handle_highlight = StyleBoxFlat.new()
	handle_highlight.bg_color = Color(\"#FFF9DB\")  # Lighter yellow
	
	# Circular shape
	handle_highlight.corner_radius_top_left = 999
	handle_highlight.corner_radius_top_right = 999
	handle_highlight.corner_radius_bottom_left = 999
	handle_highlight.corner_radius_bottom_right = 999
	
	# Thick colored border when active
	handle_highlight.border_color = color
	handle_highlight.border_width_left = 4
	handle_highlight.border_width_right = 4
	handle_highlight.border_width_top = 4
	handle_highlight.border_width_bottom = 4
	
	# Pulsing glow effect
	handle_highlight.shadow_color = color
	handle_highlight.shadow_size = 20
	handle_highlight.shadow_offset = Vector2(0, 0)
	
	# Apply all styles
	slider.add_theme_stylebox_override(\"slider\", bg_style)
	slider.add_theme_stylebox_override(\"grabber_area\", bg_style)
	slider.add_theme_stylebox_override(\"grabber_area_highlight\", fill_style)
	slider.add_theme_stylebox_override(\"grabber\", handle_style)
	slider.add_theme_stylebox_override(\"grabber_highlight\", handle_highlight)
	
	# Set slider grabber size for circular handle (makes it actually circular)
	slider.custom_minimum_size.y = 30  # Taller track for circular handle
	
	# Connect to show value change
	slider.value_changed.connect(func(value): update_volume_display(slider, value))
	slider.mouse_entered.connect(func(): highlight_volume_display(slider))
	slider.mouse_exited.connect(func(): unhighlight_volume_display(slider))

func add_volume_percentage(slider: HSlider, color: Color):
	# Create retro percentage display inside the circular handle
	
	# Container for the percentage (will be positioned on the handle)
	var percentage_container = Control.new()
	percentage_container.name = \"PercentageContainer\"
	percentage_container.mouse_filter = Control.MOUSE_FILTER_IGNORE
	slider.add_child(percentage_container)
	
	# Retro percentage label
	var percentage_label = Label.new()
	percentage_label.name = \"PercentageLabel\"
	percentage_label.text = \"0%\"
	percentage_label.horizontal_alignment = HORIZONTAL_ALIGNMENT_CENTER
	percentage_label.vertical_alignment = VERTICAL_ALIGNMENT_CENTER
	percentage_label.mouse_filter = Control.MOUSE_FILTER_IGNORE
	
	# Retro styling for percentage
	percentage_label.add_theme_color_override(\"font_color\", Color(\"#2D1B00\"))  # Dark brown
	percentage_label.add_theme_font_size_override(\"font_size\", 15)
	percentage_label.add_theme_constant_override(\"outline_size\", 1)
	percentage_label.add_theme_color_override(\"font_outline_color\", Color.WHITE)
	
	# Make it bold and pixelated
	percentage_label.add_theme_constant_override(\"shadow_offset_x\", 1)
	percentage_label.add_theme_constant_override(\"shadow_offset_y\", 1)
	percentage_label.add_theme_color_override(\"font_shadow_color\", Color(1, 1, 1, 0.5))
	
	percentage_container.add_child(percentage_label)
	
	# Store reference to update position
	slider.set_meta(\"percentage_container\", percentage_container)
	slider.set_meta(\"percentage_label\", percentage_label)
	
	# Set initial position and size
	update_percentage_position(slider, slider.value)

func update_percentage_position(slider: HSlider, value: float):
	var percentage_container = slider.get_meta(\"percentage_container\", null)
	var percentage_label = slider.get_meta(\"percentage_label\", null)
	
	if percentage_container and percentage_label:
		# Calculate position on slider (moves with handle)
		var slider_width = slider.size.x
		var handle_position = value * (slider_width - 30)  # Account for handle width
		
		# Center the percentage display on the handle
		percentage_container.position = Vector2(handle_position - 15, -15)  # Above the handle
		percentage_label.text = str(int(value * 100)) + \"%\"
		
		# Change color based on volume level
		if value < 0.1:
			percentage_label.add_theme_color_override(\"font_color\", Color(\"#666666\"))
		elif value < 0.5:
			percentage_label.add_theme_color_override(\"font_color\", Color(\"#2D1B00\"))
		else:
			percentage_label.add_theme_color_override(\"font_color\", Color(\"#FF6B35\"))

func update_volume_display(slider: HSlider, value: float):
	var percentage_label = slider.get_meta(\"percentage_label\", null)
	if percentage_label:
		percentage_label.text = str(int(value * 100)) + \"%\"
		update_percentage_position(slider, value)
		
		# Pulse animation when changing
		var tween = create_tween()
		tween.tween_property(percentage_label, \"scale\", Vector2(1.2, 1.2), 0.1)
		tween.tween_property(percentage_label, \"scale\", Vector2(1.0, 1.0), 0.1)

func highlight_volume_display(slider: HSlider):
	var percentage_label = slider.get_meta(\"percentage_label\", null)
	if percentage_label:
		percentage_label.add_theme_color_override(\"font_color\", Color.WHITE)
		percentage_label.add_theme_color_override(\"font_outline_color\", Color(\"#FF6B35\"))
		
		# Add shine effect
		var tween = create_tween()
		tween.tween_property(percentage_label, \"modulate\", Color(1, 1, 1, 1), 0.2)

func unhighlight_volume_display(slider: HSlider):
	var percentage_label = slider.get_meta(\"percentage_label\", null)
	if percentage_label:
		# Reset to original colors based on volume
		var value = slider.value
		if value < 0.1:
			percentage_label.add_theme_color_override(\"font_color\", Color(\"#666666\"))
		elif value < 0.5:
			percentage_label.add_theme_color_override(\"font_color\", Color(\"#2D1B00\"))
		else:
			percentage_label.add_theme_color_override(\"font_color\", Color(\"#FF6B35\"))
		
		percentage_label.add_theme_color_override(\"font_outline_color\", Color.WHITE)

func style_retro_label(label: Label, color: Color):
	# Retro text styling
	label.add_theme_color_override(\"font_color\", Color.WHITE)
	label.add_theme_font_size_override(\"font_size\", 22)
	
	# Thick retro outline matching slider color
	label.add_theme_constant_override(\"outline_size\", 3)
	label.add_theme_color_override(\"font_outline_color\", color.darkened(0.4))
	
	# Drop shadow for depth
	label.add_theme_constant_override(\"shadow_offset_x\", 2)
	label.add_theme_constant_override(\"shadow_offset_y\", 2)
	label.add_theme_color_override(\"font_shadow_color\", Color(0, 0, 0, 0.7))
	
	# Center align
	label.horizontal_alignment = HORIZONTAL_ALIGNMENT_CENTER
	
	# Optional: Add small sun icon next to label
	add_label_icon(label, color)

func add_label_icon(label: Label, color: Color):
	# Add a tiny retro sun icon next to the label
	var icon = TextureRect.new()
	
	# Create a simple retro sun (8x8 pixel style)
	var image = Image.create(12, 12, false, Image.FORMAT_RGBA8)
	image.fill(Color.TRANSPARENT)
	
	# Draw pixel sun
	for x in 12:
		for y in 12:
			var dist = Vector2(x, y).distance_to(Vector2(6, 6))
			if dist < 3:
				image.set_pixel(x, y, color)  # Sun center
			elif dist > 4 and dist < 5:
				# Draw cardinal direction rays
				if x == 6 or y == 6 or abs(x - 6) == abs(y - 6):
					image.set_pixel(x, y, color.lightened(0.3))
	
	var texture = ImageTexture.create_from_image(image)
	icon.texture = texture
	icon.stretch_mode = TextureRect.STRETCH_KEEP_ASPECT_CENTERED
	icon.size = Vector2(16, 16)
	icon.position = Vector2(label.position.x - 10, label.position.y + 4)
	
	# Add to label's parent
	label.get_parent().add_child(icon)
	
	# Add subtle animation
	var tween = create_tween()
	tween.set_loops()
	tween.tween_property(icon, \"rotation\", TAU, 10.0)  # Slow rotation
"

[node name="Node2D" type="Node2D"]

[node name="Back" type="Sprite2D" parent="."]
position = Vector2(576, 360)
scale = Vector2(3, 3)
texture = ExtResource("1_se8ut")

[node name="Middle" type="Sprite2D" parent="."]
position = Vector2(88, 464)
texture = ExtResource("2_ao2gm")

[node name="Middle2" type="Sprite2D" parent="."]
position = Vector2(264, 464)
texture = ExtResource("2_ao2gm")

[node name="Middle3" type="Sprite2D" parent="."]
position = Vector2(440, 464)
texture = ExtResource("2_ao2gm")

[node name="Middle4" type="Sprite2D" parent="."]
position = Vector2(616, 464)
texture = ExtResource("2_ao2gm")

[node name="Middle5" type="Sprite2D" parent="."]
position = Vector2(792, 464)
texture = ExtResource("2_ao2gm")

[node name="Middle6" type="Sprite2D" parent="."]
position = Vector2(968, 464)
texture = ExtResource("2_ao2gm")

[node name="Middle7" type="Sprite2D" parent="."]
position = Vector2(1144, 464)
texture = ExtResource("2_ao2gm")

[node name="Options" type="Sprite2D" parent="."]
position = Vector2(584, 368)
scale = Vector2(2.9880953, 2.9880948)
texture = ExtResource("3_ao2gm")

[node name="Node" type="Node" parent="."]
script = SubResource("GDScript_07a1d")

[node name="Label" type="Label" parent="Node"]
offset_left = 480.0
offset_top = 152.0
offset_right = 677.0
offset_bottom = 192.0
theme_override_fonts/font = ExtResource("4_07a1d")
theme_override_font_sizes/font_size = 45
text = "Options"

[node name="Label2" type="Label" parent="Node"]
offset_left = 482.0
offset_top = 154.0
offset_right = 679.0
offset_bottom = 194.0
theme_override_fonts/font = ExtResource("4_07a1d")
theme_override_font_sizes/font_size = 45
text = "Options"

[node name="BackBtn" type="Button" parent="."]
offset_left = 360.0
offset_top = 256.0
offset_right = 400.0
offset_bottom = 280.0
theme = ExtResource("5_kls10")
theme_override_styles/normal = SubResource("StyleBoxTexture_w5qgn")
theme_override_styles/pressed = SubResource("StyleBoxTexture_kls10")
theme_override_styles/hover = SubResource("StyleBoxTexture_0kfld")

[node name="Volume-Slider" type="Control" parent="."]
layout_mode = 3
anchors_preset = 0
offset_left = 496.0
offset_top = 296.0
offset_right = 536.0
offset_bottom = 336.0
script = SubResource("GDScript_0kfld")

[node name="master_label" type="Label" parent="Volume-Slider"]
layout_mode = 0
offset_top = -16.0
offset_right = 168.0
offset_bottom = 7.0
theme_override_fonts/font = ExtResource("4_07a1d")
theme_override_font_sizes/font_size = 20
text = "Master Volume"

[node name="music_label" type="Label" parent="Volume-Slider"]
layout_mode = 0
offset_left = 8.0
offset_top = 48.0
offset_right = 159.0
offset_bottom = 71.0
theme_override_fonts/font = ExtResource("4_07a1d")
theme_override_font_sizes/font_size = 20
text = "Music Volume"

[node name="sound_effect_label" type="Label" parent="Volume-Slider"]
layout_mode = 0
offset_left = -32.0
offset_top = 112.0
offset_right = 207.0
offset_bottom = 135.0
theme_override_fonts/font = ExtResource("4_07a1d")
theme_override_font_sizes/font_size = 20
text = "Sound Effect Volume"

[node name="Master" parent="Volume-Slider" instance=ExtResource("7_0kfld")]
layout_mode = 0
offset_left = -64.0
offset_top = 16.0
offset_right = 224.0
offset_bottom = 32.0
bus_name = "Master"

[node name="Music" parent="Volume-Slider" instance=ExtResource("7_0kfld")]
layout_mode = 0
offset_left = -64.0
offset_top = 80.0
offset_right = 224.0
offset_bottom = 96.0
bus_name = "Music"

[node name="Sound_Effect" parent="Volume-Slider" instance=ExtResource("7_0kfld")]
layout_mode = 0
offset_left = -64.0
offset_top = 144.0
offset_right = 224.0
offset_bottom = 160.0
bus_name = "Sound Effects"

[connection signal="pressed" from="BackBtn" to="Node" method="_on_back_btn_pressed"]
